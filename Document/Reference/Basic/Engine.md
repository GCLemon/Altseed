# エンジン (Engine)

## 概要

Altseedの機能を提供します。初期化、終了処理及び、殆どの機能を使用するためのプロパティを持っています。Altseedを使用するためには必ずエンジンを使用する必要があります。

エンジンでAltseedの初期化を行えます。
シーンの変更や終了処理もエンジンで行います。

フレームレート、及びゲーム内時間に関する詳細に関しては[基本設計](./../BasicDesign.md)を参照してください。

カーソル、クリップボード操作等、他に属していない機能へのアクセスも提供します。

## 主なメソッド

| 名称 | 説明 |
|---|---|
| Initialize | Altseedを初期化します。使用開始時に必ず実行します。 |
| DoEvents | Altseedのフレーム開始処理を実行します。毎フレームの開始時に必ず実行します。falseを返した場合、ACEを終了させる必要があります。 |
| Update | Altseedの毎フレームの更新処理を実行します。毎フレーム、かならず実行します。 |
| Terminate | Altseedの終了処理を実行します。Altseedを終了時に必ず実行します。 |
| ChangeScene | 更新するシーンを変更します。 |
| ChangeSceneWithTransition | トランジションを適用し、更新するシーンを変更します。 |
| Close | Altseedのウインドウを閉じます。 |
| TakeScreenshot | スクリーンショットを撮影し、画像として保存します。 |
| CaptureScreenAsGifAnimation | 画面を録画し、gifアニメとして保存します。 |

## 主なプロパティ

### フレームレート系

| 名称 | 説明 |
|---|---|
| CurrentFPS | 現在のFPS |
| TargetFPS | 目標のFPS。このFPSに近づくように内部の更新が実行されます。 |
| DeltaTime | 1フレームの処理にかかった時間 |
| TimeSpan | 処理にかかった時間に対する時間指定可能な機能が進行する時間の倍率 |
| FramerateMode | フレームレート制御方法 |

### 各種機能

|名称|説明|
|---|---|
|Logger|ログ出力機能にアクセスします。|
|Profiler|[プロファイリング機能](../Profiling/Profiler.md)にアクセスします。|
|Keyboard|[キーボード入力機能](../Input/Keyboard.md)にアクセスします。|
|Mouse|[マウス入力機能](../Input/Mouse.md)にアクセスします。|
|JoystickContainer|[ジョイスティック入力機能](../Input/JoystickContainer.md)にアクセスします。|
|Sound|[音声再生機能](../Sound/SoundSource.md)にアクセスします。|
|Graphics|[グラフィックス関連機能](../Graphics/Graphics.md)にアクセスします。|
|AnimationSystem|アニメーション機能にアクセスします。|
|File|[ファイル(ファイルパッケージ)機能](../IO/File.md)にアクセスします。|
|ClipboardString|クリップボードに保存された文字列を読み書きします。|
## 主なイベント

なし

## 初期化時のオプションについて

Altseedを初期化する際に、`Initialize`メソッドに`EngineOption`構造体のインスタンスを渡すことで、アプリケーションの設定をカスタマイズできます。`EngineOption`構造体でカスタマイズできる設定を開設します。

### 主な設定

* `IsFullScreen`フィールドを`true`に設定すると、アプリケーションはフルスクリーンで起動します。
* `GraphicsDevice`フィールドに`GraphicsDeviceType.OpenGL`や`GraphicsDeviceType.DirectX`などを指定することで、画面の描画に用いるデバイスを選ぶことができます。
* `WindowPosition`を`Centering`に設定すると、ウィンドウで起動する場合にディスプレイの中心にウィンドウが開きます。

### リロード機能(IsRelodingEnabled)

`IsRelodingEnabled`を`true`にすると、ゲームが起動中でも画像を編集するとリアルタイムにゲーム中に反映される**リロード機能**が有効になります。詳細は[リロード](./../Misc/Reloading.md)を参照してくだい。

### 自動生成レイヤー(AutoGeneratedLayer)

`AutoGeneratedLayer`に適当な値を設定すると、Altseedの初期化時に自動生成するレイヤーの種類を選んだり、レイヤーを自動生成しないようにすることができます。

基本的にAltseedでは、自分でシーンとレイヤーを作成してエンジンに追加する必要があります。
しかし、初心者に使い方を教える際やサンプルなどの短いプログラムではシーンとレイヤーの機能を使う必要がなく、シーンとレイヤーの生成は冗長なソースコードになってしまいます。そこで、初期化時に自動生成されるレイヤーの種類を設定することで自動的にシーンとレイヤーが生成されるようになります。

生成されたシーンとレイヤーには、`Engine.AddObject2D` というメソッドを用いてオブジェクトを追加できます。

また、生成されたシーンとレイヤーは特殊なものではなく、シーンを切り替えた時に消滅します。

### ColorSpace

Altseedでは、初期化時にカラースペースを設定できます。

通常、ディスプレイや画像にはガンマ補正、逆ガンマ補正が適用された状態になっています。ディスプレイは画素の値と等しい輝度を表示しているわけではなく、
ある一定のカーブに従った輝度を表示しています。画像はディスプレイが画素の値と等しい輝度を出せない前提で記録されています。この画素値への補正がガンマ補正です。

ガンマ補正が適用されている場合、ただ、画像を表示するだけなら問題は発生しませんが、加算や3D表示をしますとディスプレイに輝度を加算した結果が正しく表示されません。

画素値をそのまま加算する場合を、ガンマスペース、輝度で加算する場合をリニアスペースと呼んでいます。

デフォルトではリニアスペースですが、画素の値で計算したい場合、ガンマスペースを選択します。

![カラースペース](img/ColorSpace_GammaSpace.png)

ガンマスペース

![カラースペース](img/ColorSpace_LinearSpace.png)

リニアスペース

## クリップボードについて

Altseedでは、コピー貼り付けに使用されるクリップボードを制御できます。ClipboardStringを経由することでコピー貼り付けに使用される文字列を読み書きできます。

## 使用方法

全てのサンプルで使用されているので、そちらを参照してください。
